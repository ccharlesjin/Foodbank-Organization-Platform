<!DOCTYPE html>
<html lang="en" class="html">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSVP Management</title>
    <link rel="stylesheet" href="manager.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/vue@3"></script>
    <style>
        input, select { display: block; width: 100%; }
        .hidden, [style*="display: none"] { display: none !important; }
        .container {
            display: flex;
        }
        .table-container, .details-container {
            width: 50%;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .info-container {
            text-align: center;
            font-size: 1.5em;
            margin-bottom: 20px;
        }
    </style>
</head>

<body class="full-height body">
    <div id="app">
        <header>
            <div class="navbar">
                <div class="logo">RSVP Management</div>
                <nav>
                    <ul>
                        <li><a href="/home">Home</a></li>
                        <li><a href="/about">About</a></li>
                        <li><a href="/location">Location</a></li>
                        <li><a href="#">Contact</a></li>
                        <li><a href="/rsvp">Show RSVP</a></li>
                        <li><a href="#" id="logout-button" onclick="loadSection('logout', event)">Logout</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <div class="sidebar">
            <h2>Dashboard</h2>
            <ul>
                <li><a href="#" onclick="loadSection('info')">Personal Info</a></li>
                <li><a href="#" onclick="loadSection('security')">Security</a></li>
                <li><a href="#" onclick="loadSection('activities')">Organization Activities</a></li>
                <li class="current-menu"><a href="/manager/members">Member Management</a></li>
                <li><a href="/manager/events">Events Management</a></li>
                <li><a href="#">RSVP Management</a></li>
            </ul>
        </div>

        <main class="main full-height flex-grow content">
            <h2>RSVP Management</h2>

            <div>
                <label for="activitySelect">Select Event:</label>
                <select id="activitySelect" v-model="selectedActivity" @change="fetchRSVPs">
                    <option v-for="activity in activities" :value="activity.activity_id">{{ activity.activity_name }}</option>
                </select>
            </div>

            <div v-if="selectedActivity">
                <div class="info-container">
                    <p>Total RSVP'd Yes: {{ totalRSVPYes }}</p>
                    <p>RSVP Yes Percentage: {{ rsvpYesPercentage }}%</p>
                </div>
                <div class="container">
                    <div class="table-container">
                        <h2>RSVP Yes</h2>
                        <table id="rsvpsTableYes">
                            <thead>
                                <tr>
                                    <th>User Name</th>
                                    <th>Status</th>
                                    <th>Remarks</th>
                                    <th>Reply Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="rsvp in filteredRSVPsYes" :key="rsvp.rsvp_id">
                                    <td>{{ rsvp.user_name }}</td>
                                    <td>{{ rsvp.status }}</td>
                                    <td>{{ rsvp.remarks }}</td>
                                    <td>{{ rsvp.reply_date }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="table-container">
                        <h2>RSVP No</h2>
                        <table id="rsvpsTableNo">
                            <thead>
                                <tr>
                                    <th>User Name</th>
                                    <th>Status</th>
                                    <th>Remarks</th>
                                    <th>Reply Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="rsvp in filteredRSVPsNo" :key="rsvp.rsvp_id">
                                    <td>{{ rsvp.user_name }}</td>
                                    <td>{{ rsvp.status }}</td>
                                    <td>{{ rsvp.remarks }}</td>
                                    <td>{{ rsvp.reply_date }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>RSVP Management System &copy; 2024</p>
        </footer>
    </div>

    <script>
        function loadSection(section, event) {
            event.preventDefault();  // 阻止<a>标签的默认行为
            if (section === 'logout') {
                // 发送请求到服务器端的logout路由
                fetch('/manager/logout', { method: 'GET' })
                .then(response => {
                    // 可以根据服务器响应处理逻辑
                    window.location.href = '/manager_login.html';  // 重定向到登录页面
                })
                .catch(error => {
                    console.error('Logout failed:', error);
                });
            }

            // 可以添加其他 'section' 处理逻辑，如果 'loadSection' 用于多个目的
        }

        Vue.createApp({
            data() {
                return {
                    activities: [
                        { activity_id: 1, activity_name: 'Event A', activity_date: '2024-01-01', activity_number_of_people: 100, activity_information: 'Info A' },
                        { activity_id: 2, activity_name: 'Event B', activity_date: '2024-01-02', activity_number_of_people: 200, activity_information: 'Info B' },
                        { activity_id: 3, activity_name: 'Event C', activity_date: '2024-01-03', activity_number_of_people: 300, activity_information: 'Info C' }
                    ],
                    selectedActivity: null,
                    rsvps: [],
                    selectedRSVP: null
                };
            },
            computed: {
                filteredRSVPsYes() {
                    return this.rsvps.filter(rsvp => rsvp.status === 'Yes');
                },
                filteredRSVPsNo() {
                    return this.rsvps.filter(rsvp => rsvp.status === 'No');
                },
                totalRSVPYes() {
                    return this.filteredRSVPsYes.length;
                },
                rsvpYesPercentage() {
                    const totalRSVP = this.rsvps.length;
                    return totalRSVP > 0 ? ((this.totalRSVPYes / totalRSVP) * 100).toFixed(2) : 0;
                }
            },
            methods: {
                fetchRSVPs() {
                    const hardcodedRSVPs = {
                        1: [
                            { rsvp_id: 1, user_name: 'John Doe', status: 'Yes', remarks: 'Coming with 2 guests', reply_date: '2024-01-10' },
                            { rsvp_id: 2, user_name: 'Jane Doe', status: 'No', remarks: 'Out of town', reply_date: '2024-01-11' }
                        ],
                        2: [
                            { rsvp_id: 3, user_name: 'Alice Johnson', status: 'Yes', remarks: 'Vegetarian', reply_date: '2024-01-12' },
                            { rsvp_id: 4, user_name: 'Bob Smith', status: 'No', remarks: 'Busy with work', reply_date: '2024-01-13' }
                        ],
                        3: [
                            { rsvp_id: 5, user_name: 'Charlie Brown', status: 'Yes', remarks: 'Needs wheelchair access', reply_date: '2024-01-14' },
                            { rsvp_id: 6, user_name: 'Lucy Van Pelt', status: 'No', remarks: 'Has another event', reply_date: '2024-01-15' }
                        ]
                    };

                    this.rsvps = hardcodedRSVPs[this.selectedActivity] || [];
                }
            },
            mounted() {
                // 初始化时获取活动信息，可以通过API调用实际获取数据
                this.fetchRSVPs();
            }
        }).mount('#app');


    //     Vue.createApp({
    //         data() {
    //             return {
    //                 managerBranchId: [],
    //                 members: [],
    //                 branches: [],
    //                 editMemberId: null,
    //                 editData: {}
    //             };
    //         },
    //     methods: {
    //         fetchBranchId() {
    //                 fetch('/manager/api/branch_id')
    //                 .then(response => response.json())
    //                 .then(data => {
    //                     console.log("Got manager branch id:", data);
    //                     this.managerBranchId = data;
    //                 })
    //                 .catch(error => console.error('Error loading the managerBranchId:', error));
    //         },
    //         fetchMembers() {
    //             fetch('/manager/api/members', {
    //                 method: 'GET',
    //             })
    //             .then(response => response.json())
    //             .then(data => {
    //                 console.log("Loaded members:", data);
    //                 this.members = data;
    //             })
    //             .catch(error => console.error('Error loading the members:', error));
    //         },
    //         fetchBranches() {
    //             fetch('/api/branches', {
    //                 method: 'GET',
    //             })
    //             .then(response => response.json())
    //             .then(data => {
    //                 console.log("Loaded branches:", data);
    //                 this.branches = data;
    //             })
    //             .catch(error => console.error('Error loading branches:', error));
    //         },
    //         getBranchName(branchId) {
    //             // Find the branch with the given ID and return its name
    //             const branch = this.branches.find(branch => branch.branch_id === branchId);
    //             return branch ? branch.branch_name : 'Unknown';  // Return 'Unknown' if no branch is found
    //         },
    //         editMember(id) {
    //             this.editMemberId = id;
    //             const member = this.members.find(m => m.user_id === id);
    //             this.editData = { ...member, branch: member.branch_id };  // include branch id for editing
    //         },
    //         saveChanges(id) {
    //             if (this.validateData(this.editData)) {
    //                 fetch(`/manager/update-member/${id}`, {
    //                     method: 'POST',
    //                     headers: {
    //                         'Content-Type': 'application/json',
    //                         // 'Authorization': 'Bearer ' + localStorage.getItem('jwt'),
    //                     },
    //                     body: JSON.stringify(this.editData)
    //                 })
    //                 .then(response => {
    //                     if (!response.ok) {
    //                         throw new Error('Network response was not ok');
    //                     }
    //                     return response.json();
    //                 })
    //                 .then(data => {
    //                     alert(data.message); // The backend sends a message on success
    //                     this.fetchMembers(); // Re-fetch members or update the local state
    //                     this.editMemberId = null;
    //                 })
    //                 .catch(error => {
    //                     console.error('Error:', error);

    //                     alert('Failed to save data');
    //                 });
    //             } else {
    //                 alert('Data format is not correct');
    //             }
    //         },
    //         deleteMember(id) {
    //             if (confirm("Are you sure you want to delete this member?")) {
    //                 fetch(`/manager/delete-member/${id}`, {
    //                     method: 'DELETE',
    //                     // headers: {
    //                     //     'Authorization': 'Bearer ' + localStorage.getItem('jwt'),
    //                     // },
    //                 })
    //                 .then(response => {
    //                     if (response.ok) {
    //                         return response.json();
    //                     }
    //                     throw new Error('Failed to delete member');
    //                 })
    //                 .then(data => {
    //                     this.members = this.members.filter(m => m.user_id !== id);
    //                     alert(data.message);
    //                 })
    //                 .catch(error => {
    //                     console.error('Error:', error);
    //                     alert(error.message);
    //                 });
    //             }
    //         },
    //         validateData(data, isAdding = false) {
    //             // 检查必需字段是否非空
    //             if (!data.user_name || !data.email || !data.full_name || (isAdding && !data.password)) {
    //                 return false;
    //             }

    //             // 使用正则表达式检查电子邮件格式
    //             const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
    //             if (!emailRegex.test(data.email)) {
    //                 return false;
    //             }

    //             if (data.p) {
    //                 const phoneRegex = /^\d{10,}$/;  // 简单的数字验证
    //                 if (!phoneRegex.test(data.p)) {
    //                     return false;
    //                 }
    //             }

    //             return true;
    //         }
    //     },
    //     mounted() {
    //         this.fetchBranchId();
    //         this.fetchMembers();
    //         this.fetchBranches();
    //     }
    // }).mount('#app');

    </script>
</body>
</html>
